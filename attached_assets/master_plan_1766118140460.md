I need to update my Music Generation app to switch from Sonauto to Fal.ai (Minimax v2) and fix the "Optimize with AI" buttons in the UI.

I have created a detailed plan in the file `ai_integration_plan.md`. Please analyze your current file structure and implement the following steps, adapting paths as necessary to fit the existing project:

1.  **Create Context Files:**
    * Create a directory (e.g., `context/` or `agent_tools/`) and populate it with the 4 Markdown files defined in Section 2 of `ai_integration_plan.md`.
    * These files are the "Source of Truth" for our AI logic.

2.  **Backend - Optimization Service:**
    * Create a service (e.g., `services/optimizer.py`) that exposes a function to read a specific `.md` file and use it to process user text via GPT-4o.
    * Create an API endpoint `POST /optimize` that accepts a field type (neuro, lyrics, etc.) and text, runs the service, and returns the optimized text.

3.  **Backend - Fal Integration:**
    * Install `fal-client`.
    * Create `clients/fal_client.py` to handle the `minimax-music/v2` async queue (submit -> poll).
    * Create `services/payload_factory.py`. This must use the `sys_payload.md` file to "Translate" and "Merge" the 5 UI fields into the 2 Fal fields (`prompt`, `lyrics_prompt`) using GPT-4o. **Crucial:** Ensure it implements the "Split Rule" for Musical Effects (Timbre vs Structure) described in the plan.

4.  **Backend - Validation:**
    * Implement `tools/validators.py` to enforce the "Double Hash" (convert brackets to ## for instruments) and "Breath" (newlines) protocols via Regex.

5.  **Frontend Integration:**
    * Find the "Optimize with AI" buttons in the UI components.
    * Wire them to call the new `POST /optimize` endpoint. Pass the correct "mode" (neuro, lyrics, etc.) for each button.
    * Ensure the input field updates with the returned text.

6.  **Final Endpoint:**
    * Update the main generation route to use the new `PayloadFactory` -> `Validator` -> `FalClient` pipeline.

Follow the logic in `ai_integration_plan.md` strictly.